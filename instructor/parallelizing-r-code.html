<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>R for the HPCC: Parallelizing your R code with <code>future</code></title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" type="text/css" href="../assets/styles.css"><script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [ ['$','$'], ['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="manifest" href="../site.webmanifest"><link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"></head><body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav software"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="ICER" src="../assets/images/icer-rectangle.png"></div>
    </div>
    <div class="selector-container ">
      
      
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='../parallelizing-r-code.html';">Learner View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav software" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="ICER" src="../assets/images/icer-square.png"></div>
    <div class="lesson-title-md">
      R for the HPCC
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
      <i role="img" aria-label="search button" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            R for the HPCC
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><hr><li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul></li>
      </ul></div>
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled><input class="form-control me-2 searchbox" type="search" placeholder="Search" aria-label="Search"><button class="btn btn-outline-success tablet-search-button" type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="search button"></i>
        </button>
      </fieldset></form>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  R for the HPCC
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 40%" class="percentage">
    40%
  </div>
  <div class="progress software">
    <div class="progress-bar software" role="progressbar" style="width: 40%" aria-valuenow="40" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
  <div id="sidebar-col" class="col-lg-4">
    <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle"><i class="search-icon" data-feather="x" role="img"></i></button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../parallelizing-r-code.html">Learner View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->
      
            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="rstudio-ondemand.html">1. Accessing RStudio through OnDemand</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="managing-r-env-packages.html">2. Managing R package installation and environment</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        3. Parallelizing your R code with <code>future</code>
        </span>
      </button>
    </div><!--/div.accordion-header-->
        
    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#basics-of-parallelization">Basics of parallelization</a></li>
<li><a href="#writing-code-that-runs-on-multiple-cores">Writing code that runs on multiple cores</a></li>
<li><a href="#writing-code-that-runs-on-multiple-nodes">Writing code that runs on multiple nodes</a></li>
<li><a href="#other-ways-to-use-the-future-backends">Other ways to use the <code>future</code> backends</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="r-command-line.html">4. Using R on the command line</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="r-slurm-jobs.html">5. Submitting R code to SLURM</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr><li><a class="dropdown-item" href="reference.html">Reference</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width resources"><a href="../instructor/aio.html">See all in one page</a>

            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">
            
            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/managing-r-env-packages.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/r-command-line.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/managing-r-env-packages.html" rel="prev"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous: Managing R package</a>
        <a class="chapter-link float-end" href="../instructor/r-command-line.html" rel="next">Next: Using R on the... <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Parallelizing your R code with <code>future</code></h1>
        <p> Last updated on 2023-11-21 | 
        
        <a href="https://github.com/cgross95/r-for-hpcc/edit/main/episodes/parallelizing-r-code.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
        
        
        
        <p>Estimated time <i aria-hidden="true" data-feather="clock"></i> 12 minutes </p>
        
        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right"> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How can you use HPCC resources to make your R code run faster?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Introduce the R package <code>future</code>
</li>
<li>Demonstrate some simple ways to parallelize your code with
<code>foreach</code> and <code>future_lapply</code>
</li>
<li>Explain different parallelization backends</li>
</ul></div>
</div>
</div>
</div>
</div>
<section id="basics-of-parallelization"><h2 class="section-heading">Basics of parallelization<a class="anchor" aria-label="anchor" href="#basics-of-parallelization"></a>
</h2>
<hr class="half-width"><p>The HPCC is made up of lots of computers that have processors with
lots of cores. Your laptop probably has a processor with 4-8 cores while
the largest nodes on the HPCC have 128 cores.</p>
<p>All this said though, HPCC nodes are <em>not</em> inherently faster
than standard computers. In fact, having many cores in a processor
usually comes at the cost of slightly slower processing speeds. One of
the primary benefits of running on the HPCC is that that you can speed
up your throughput by doing many tasks at the same time on multiple
processors, nodes, or both. This is called running your code in
<em>parallel</em>.</p>
<p>Except for a few exceptions (like linear algebra routines), this
speedup isn’t automatic! You will need to make some changes to your code
so it knows what resources to use and how to split up its execution
across those resources. We’ll use the “<a href="https://www.futureverse.org/" class="external-link">Futureverse</a>” of R packages to
help us do this quickly.</p>
</section><section id="writing-code-that-runs-on-multiple-cores"><h2 class="section-heading">Writing code that runs on multiple cores<a class="anchor" aria-label="anchor" href="#writing-code-that-runs-on-multiple-cores"></a>
</h2>
<hr class="half-width"><p>Let’s start with a small example of some code that can be sped up by
running in parallel. In RStudio, create a new R Script and enter the
following code:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fu">proc.time</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu">rep</span><span class="op">(</span><span class="cn">NA</span>, <span class="fu">length</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Preallocate the result vector</span></span>
<span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu">seq_along</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">Sys.sleep</span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span></span>
<span>  <span class="va">z</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">sqrt</span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="fu">proc.time</span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="va">t</span><span class="op">)</span></span></code></pre>
</div>
<p>Create a new directory in your <code>r_workshop</code> project called
<code>src</code> and save it as <code>src/test_sqrt.R</code>. Click the
Source button at the top of the editor window in RStudio, and see the
output:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>   user  system elapsed 
  0.016   0.009   5.006</code></pre>
</div>
<p>This means that it took about 5 seconds for the code to run. Of
course, this all came from us asking the code to sleep for half a second
each loop iteration! This is just to simulate a long running chunk of
code that we might want to parallelize.</p>
<div id="a-digression-on-vectorization" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="a-digression-on-vectorization" class="callout-inner">
<h3 class="callout-title">A digression on vectorization<a class="anchor" aria-label="anchor" href="#a-digression-on-vectorization"></a>
</h3>
<div class="callout-content">
<p>Ignoring the <code>Sys.sleep(0.5)</code> part of our loop, if we just
wanted the square root of all of the elements in <code>x</code>, we
should never use a loop! R thrives with vectorization, meaning that we
can apply a function to a whole vector at once. This will also trigger
some of those linear algebra libraries that can auto-parallelize some of
your code.</p>
<p>For example, compare</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fu">proc.time</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu">rep</span><span class="op">(</span><span class="cn">NA</span>, <span class="fu">length</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Preallocate the result vector</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu">seq_along</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span><span class="va">z</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">sqrt</span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="fu">proc.time</span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="va">t</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>   user  system elapsed 
  0.004   0.000   0.005 </code></pre>
</div>
<p>to</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fu">proc.time</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu">sqrt</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="fu">proc.time</span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="va">t</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>   user  system elapsed 
      0       0       0 </code></pre>
</div>
<p>Not only is the vectorized code much cleaner, it’s much faster
too!</p>
</div>
</div>
</div>
<p>Let’s parallelize this with a combination of the <code>foreach</code>
and the <code>doFuture</code> packages. Start a new R script with the
following lines</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">foreach</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">doFuture</span><span class="op">)</span></span>
<span><span class="fu">plan</span><span class="op">(</span><span class="va">sequential</span><span class="op">)</span></span>
<span></span>
<span><span class="va">t</span> <span class="op">&lt;-</span> <span class="fu">proc.time</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu">foreach</span><span class="op">(</span>xi <span class="op">=</span> <span class="va">x</span><span class="op">)</span> <span class="op">%dofuture%</span> <span class="op">{</span></span>
<span>  <span class="fu">Sys.sleep</span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span></span>
<span>  <span class="fu">sqrt</span><span class="op">(</span><span class="va">xi</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">print</span><span class="op">(</span><span class="fu">proc.time</span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="va">t</span><span class="op">)</span></span></code></pre>
</div>
<p>and save as <code>src/test_sqrt_multisession.R</code>.</p>
<p>Notice that this is very close to our original code, but we made a
few changes:</p>
<ul><li>We changed the <code>for</code> loop into a <code>foreach</code>
statement.
<ul><li>The <code>xi = x</code> lets us iterate over <code>x</code> and use
<code>xi</code> as an element rather than indexing.</li>
<li>The block that happens on each “iteration” is preceded by
<code>%dofuture%</code>. This tells <code>foreach</code> how to run each
of the iterations, and in this case, uses the <code>future</code>
package behind the scenes.</li>
</ul></li>
<li>
<code>z</code> is now the output of <code>foreach</code> statement
rather than preallocated and subsequently changed on each iteration of
the <code>for</code> loop. Each element is the last result of the code
block for each input <code>xi</code>.</li>
</ul><p>Let’s run the code:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>   user  system elapsed 
  0.050   0.012   5.051</code></pre>
</div>
<p>Huh? It’s slower! Well, we forgot one thing. We changed our code to
get ready for parallelization, but we didn’t say <em>how</em> we want to
parallelize it.</p>
<p>Well, actually, we did. The <code>plan(sequential)</code> line tells
<code>future</code> that we want to run each loop iteration
sequentially, i.e., the same exact way the original for loop works! We
just added some extra overhead of having the <code>future</code> package
manage it for us.</p>
<div class="section level3">
<h3 id="the-multisession-backend">The multisession backend<a class="anchor" aria-label="anchor" href="#the-multisession-backend"></a></h3>
<p>To parallelize things, we change the plan. There are a few options,
but we’ll start with the <code>multisession</code> plan. Change
<code>plan(sequential)</code> to <code>plan(multisession)</code> and run
again:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>   user  system elapsed 
  0.646   0.019   2.642</code></pre>
</div>
<p>Much better! What future did behind the scenes is check how many
cores we have allotted to our RStudio session with</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">availableCores</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="va">cgroups.cpuset</span> </span>
<span>             <span class="fl">8</span></span></code></pre>
</div>
<p>and make that many R sessions in the background. Each of these
sessions gets a loop iteration to run, and when finished, if there are
still more, it will run another one.</p>
<p>We can tell <code>future</code> to use a certain number of workers in
the <code>plan</code>, which will override the number of cores. Add the
<code>workers</code> option to <code>plan(multisession)</code> like</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plan</span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></code></pre>
</div>
<p>and rerun to get</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>   user  system elapsed 
  0.327   0.010   1.923 </code></pre>
</div>
<p>It’s even faster! With five workers, each worker has exactly two
iterations to work on, and we don’t have the overhead of the three extra
ones that wait around to do nothing.</p>
</div>
<div class="section level3">
<h3 id="the-multicore-backend">The multicore backend<a class="anchor" aria-label="anchor" href="#the-multicore-backend"></a></h3>
<p>In addition to a <code>multisession</code> plan, we can use the
<code>multicore</code> plan to utilize all of our cores. Instead of
starting multiple R sessions, <code>future</code> forks the main process
into as many processes as specified workers. This generally has less
overhead, and one major advantage is that all of the workers share the
memory of the original process. In the <code>multisession</code> plan,
each worker copied the part of <code>x</code> it had to work on into new
memory which can really add up for large inputs. However, in the
<code>multicore</code> case, since the memory is shared, it is not
writable.</p>
<p>Unfortunately, the <code>multicore</code> plan is less stable in GUI
environments like RStudio. Thus, it can only be used in scripts <a href="r-command-line.html">running from the command line</a>, so we will
ignore it for now.</p>
</div>
</section><section id="writing-code-that-runs-on-multiple-nodes"><h2 class="section-heading">Writing code that runs on multiple nodes<a class="anchor" aria-label="anchor" href="#writing-code-that-runs-on-multiple-nodes"></a>
</h2>
<hr class="half-width"><p>Now that we know how to make the most of the cores we reserved, how
can we scale up further? One of the major benefits of the HPCC is the
fact that there are plenty of different nodes for you to run your code
on! With just a few changes to the <code>future</code> setup, we can
transition from a “multicore” to “multinode” setup.</p>
<div class="section level3">
<h3 id="the-cluster-backend">The cluster backend<a class="anchor" aria-label="anchor" href="#the-cluster-backend"></a></h3>
<p>To use the <code>cluster</code> backend, you need a list of nodes you
can access through SSH. Usually, you would submit a SLURM job requesting
multiple nodes and use these, but we will save that for <a href="r-slurm-jobs.html">a future section</a>.</p>
<p>For now, we’ll practice by using some development nodes.</p>
<p>Copy <code>src/test_sqrt_multisession.R</code> to
<code>src/test_sqrt_cluster.R</code>, and replace the <code>plan</code>
line with the following:</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hostnames</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"dev-amd20"</span>, <span class="st">"dev-intel18"</span><span class="op">)</span></span>
<span><span class="fu">plan</span><span class="op">(</span><span class="va">cluster</span>, workers <span class="op">=</span> <span class="va">hostnames</span><span class="op">)</span></span></code></pre>
</div>
<p>When we run the code, we get:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Error: there is no package called 'doFuture'</code></pre>
</div>
<p>Hmm, something went wrong. It turns out that <code>future</code>
isn’t always sure what’s available on the hosts we pass it to build the
cluster with. We have to tell it what library path to use, and that it
should set the working directory on each node to our current working
directory.</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hostnames</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span><span class="st">"dev-amd20"</span>, <span class="st">"dev-intel18"</span><span class="op">)</span></span>
<span><span class="va">wd</span> <span class="op">&lt;-</span> <span class="fu">getwd</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">setwd_cmd</span> <span class="op">&lt;-</span> <span class="fu">cat</span><span class="op">(</span><span class="st">"setwd('"</span>, <span class="va">wd</span>, <span class="st">"')"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span>
<span><span class="fu">plan</span><span class="op">(</span><span class="va">cluster</span>, workers <span class="op">=</span> <span class="va">hostnames</span>,</span>
<span>     rscript_libs <span class="op">=</span> <span class="fu">.libPaths</span><span class="op">(</span><span class="op">)</span>,</span>
<span>     rscript_startup <span class="op">=</span> <span class="va">setwd_cmd</span><span class="op">)</span></span></code></pre>
</div>
<p>Now let’s run again:</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>setwd('/mnt/ufs18/home-237/k0068027/r_workshop')   user  system elapsed 
  0.233   0.044   2.769 </code></pre>
</div>
<p>The output is a little wonky because it runs the
<code>rscript_startup</code> command, but we were still able to save
some time!</p>
</div>
<div class="section level3">
<h3 id="the-batchtools_slurm-backend">The batchtools_slurm backend<a class="anchor" aria-label="anchor" href="#the-batchtools_slurm-backend"></a></h3>
<p>As we saw, using <code>cluster</code> plan can be tricky to get
right. A much easier way to advantage of multiple nodes is to use the
<code>batchtools.slurm</code> backend. This allows us to submit SLURM
jobs for each iteration of our for loop. The HPCC scheduler will then
control where and when these jobs run, rather than you needing to
provide that information ahead of time.</p>
<p>The simplest way to do this, is to use the
<code>future.batchtools</code> package. Copy
<code>src/test_sqrt_multisession.R</code> to
<code>src/test_sqrt_slurm.R</code>, load the
<code>future.batchtool</code> package, and replace the <code>plan</code>
section with the <code>batchtools_slurm</code> plan:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">foreach</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">doFuture</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">future.batchtools</span><span class="op">)</span></span>
<span><span class="fu">plan</span><span class="op">(</span><span class="va">batchtools_slurm</span><span class="op">)</span></span></code></pre>
</div>
<p>Running the code gives us</p>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>   user  system elapsed 
  6.916   2.083  39.614</code></pre>
</div>
<p>So we experience a much longer wait… But this make sense! We just
sent off ten SLURM jobs to sit in the HPCC queue, get started, do a tiny
computation, shut down, and send back the result.</p>
<p>This is definitely <em>not</em> the kind of setting where we should
use the <code>batchtools_slurm</code> backend, but imagine if the inside
of the for loop was extremely resource intensive. In this case, it might
make sense to send each iteration off into its own job with its own
reserved resources.</p>
<p>Speaking of which, what resources did we ask for in each of these
submitted jobs? We never specified anything. The
<code>future.batchtools</code> package comes with a set of default
templates. Here’s the <code>slurm.tmpl</code> file in the
<code>library/future.batchtools/templates</code> directory under our
project directory:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">BASH<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode bash" tabindex="0"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">#!/bin/bash</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co">######################################################################</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># A batchtools launch script template for Slurm</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Author: Henrik Bengtsson </span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co">######################################################################</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --job-name=&lt;%= job.name %&gt;</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --output=&lt;%= log.file %&gt;</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --nodes=1</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH --time=00:05:00</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co">## Resources needed:</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>% <span class="cf">if</span> <span class="kw">(</span><span class="ex">length</span><span class="er">(</span><span class="ex">resources</span><span class="kw">)</span> <span class="op">&gt;</span> 0<span class="kw">)</span> <span class="kw">{</span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>  <span class="ex">opts</span> <span class="op">&lt;</span>- unlist<span class="er">(</span><span class="ex">resources,</span> use.names = TRUE<span class="kw">)</span></span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>  <span class="ex">opts</span> <span class="op">&lt;</span>- sprintf<span class="er">(</span><span class="st">"--%s=%s"</span><span class="ex">,</span> names<span class="er">(</span><span class="ex">opts</span><span class="kw">)</span><span class="ex">,</span> opts<span class="kw">)</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  <span class="ex">opts</span> <span class="op">&lt;</span>- paste<span class="er">(</span><span class="ex">opts,</span> collapse = <span class="st">" "</span><span class="kw">)</span> <span class="ex">%</span><span class="op">&gt;</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="co">#SBATCH &lt;%= opts %&gt;</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>% <span class="kw">}</span> <span class="ex">%</span><span class="op">&gt;</span></span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="co">## Launch R and evaluated the batchtools R job</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a><span class="ex">Rscript</span> <span class="at">-e</span> <span class="st">'batchtools::doJobCollection("&lt;%= uri %&gt;")'</span></span></code></pre>
</div>
<p>Now, there are some parts that don’t look like like a normal SLURM
script, but we see that each SLURM job automatically requests one node
and five minutes. The remaining resources are set to the default values
(usually 1 CPU and 750MB of memory).</p>
<p>What if you want to change these values? The strange lines in the
template SLURM script allow us to pass in extra resources when we set
the <code>plan</code>. For example, if you need each loop iteration to
have 1GB of memory and 10 minutes of runtime, we can replace the
<code>batchtools_slurm</code> line with</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">plan</span><span class="op">(</span><span class="va">batchtools_slurm</span>, resources <span class="op">=</span> <span class="fu">list</span><span class="op">(</span>mem <span class="op">=</span> <span class="st">"1GB"</span>,</span>
<span>                                        time<span class="op">=</span><span class="st">"00:10:00"</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>The <code>resources</code> argument is a list where each entry’s name
is the SLURM constraint and the value is a string with the desired
value. See the <a href="https://docs.icer.msu.edu/List_of_Job_Specifications/" class="external-link">list of job
specifications in the ICER documentation</a> for more details.</p>
<p>Unfortunately, this method of specifying resources is not very
flexible. In particular, the resource names have to satisfy R’s variable
naming rules, which means that specifying <code>cpus-per-task</code> is
impossible because of the dashes.</p>
<p>Alternatively, it is better to create your own template script that
will be used to submit your jobs. If you save a template like the one
above to your working directory as <code>batchtools.slurm.tmpl</code>,
it will be used instead. For more information, see the <a href="https://future.batchtools.futureverse.org/" class="external-link"><code>future.batchtools</code>
documentation</a>.</p>
</div>
</section><section id="other-ways-to-use-the-future-backends"><h2 class="section-heading">Other ways to use the <code>future</code> backends<a class="anchor" aria-label="anchor" href="#other-ways-to-use-the-future-backends"></a>
</h2>
<hr class="half-width"><p>We decided to setup our parallelization in a for loop using the
<code>foreach</code> package. But there are a few other ways to do this
as well. Most fit the paradigm of defining a function to “map” over the
elements in an array.</p>
<p>One common example is using the <code>lapply</code> function in base
R. We could rewrite our example above using <code>lapply</code> (without
any parallelization) like this:</p>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">slow_sqrt</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">Sys.sleep</span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span></span>
<span>  <span class="fu">sqrt</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu">lapply</span><span class="op">(</span><span class="va">x</span>, <span class="va">slow_sqrt</span><span class="op">)</span>  <span class="co"># apply slow_sqrt to each element of x</span></span></code></pre>
</div>
<p>To parallelize, we can use the <code>future.apply</code> package,
replace <code>lapply</code> with <code>future_lapply</code>, and setup
the backend exactly the same way:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">future.apply</span><span class="op">)</span></span>
<span><span class="fu">plan</span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">slow_sqrt</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">Sys.sleep</span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span></span>
<span>  <span class="fu">sqrt</span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span></span>
<span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu">future_lapply</span><span class="op">(</span><span class="va">x</span>, <span class="va">slow_sqrt</span><span class="op">)</span></span></code></pre>
</div>
<p>The “<a href="https://www.futureverse.org/" class="external-link">Futureverse</a>” (i.e.,
the list of packages related to <code>future</code>) also includes
<code>furrr</code>, a <code>future</code>-ized version of the Tidyverse
package <code>purrr</code>. Additionally, the <code>doFuture</code>
package contains adapters to parallelize <code>plyr</code> and
<code>BiocParallel</code> mapping functions.</p>
<p>The upshot is that if you have code that’s setup (or can be setup) in
the style of mapping a function over arrays, you can parallelize it by
employing an adapter to the <code>future</code> backend.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Keypoints<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul><li>Setup code you want to parallelize as “mapping” a function over an
array</li>
<li>Setup a <code>future</code> backend to distribute each of these
function applications over cores, nodes, or both</li>
<li>Use the <code>batchtools_slurm</code> backend to have
<code>future</code> submit SLURM jobs for you</li>
<li>Use a <code>future</code> adapter to link your code to the
backend</li>
</ul></div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/managing-r-env-packages.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/r-command-line.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/managing-r-env-packages.html" rel="prev"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous: Managing R package</a>
        <a class="chapter-link float-end" href="../instructor/r-command-line.html" rel="next">Next: Using R on the... <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
				<p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>
        
        <a href="https://github.com/cgross95/r-for-hpcc/edit/main/episodes/parallelizing-r-code.Rmd" class="external-link">Edit on GitHub</a>
        
	
        | <a href="https://github.com/cgross95/r-for-hpcc/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a> 
        | <a href="https://github.com/cgross95/r-for-hpcc/" class="external-link">Source</a></p>
				<p><a href="https://github.com/cgross95/r-for-hpcc/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:grosscra@msu.edu">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">
        
        <p>Materials licensed under <a href="../LICENSE.html">CC-BY 4.0</a> by the authors</p>
        
        <p><a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">Template licensed under CC-BY 4.0</a> by <a href="https://carpentries.org" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.15.0" class="external-link">sandpaper (0.15.0)</a>,
        <a href="https://github.com/carpentries/pegboard/tree/0.7.3" class="external-link">pegboard (0.7.3)</a>,
      and <a href="https://github.com/cgross95/varnish/tree/icer" class="external-link">varnish (0.2.17)</a>.</p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
			<i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back to top"></i><br><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://cgross95.github.io/r-for-hpcc/instructor/parallelizing-r-code.html",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "r, hpcc, parallel, cluster, icer",
  "name": "Parallelizing your R code with future",
  "creativeWorkStatus": "active",
  "url": "https://cgross95.github.io/r-for-hpcc/instructor/parallelizing-r-code.html",
  "identifier": "https://cgross95.github.io/r-for-hpcc/instructor/parallelizing-r-code.html",
  "dateCreated": "2023-06-30",
  "dateModified": "2023-11-21",
  "datePublished": "2023-12-12"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo
    2022-11-07: we have gotten a notification that we have an overage for our
    tracking and I'm pretty sure this has to do with Workbench usage.
    Considering that I am not _currently_ using this tracking because I do not
    yet know how to access the data, I am turning this off for now.
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setDomains", ["*.preview.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
    _paq.push(["setDoNotTrack", true]);
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
          var u="https://carpentries.matomo.cloud/";
          _paq.push(['setTrackerUrl', u+'matomo.php']);
          _paq.push(['setSiteId', '1']);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.async=true; g.src='https://cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
  </script>
  End Matomo Code --></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

